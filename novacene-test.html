<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>üì° Novacene Viewer ‚Äì Sensor Status</title>
  <style>
    body { font-family: sans-serif; padding: 1em; max-width: 800px; margin: auto; }
    textarea, select, input { width: 100%; padding: 0.5em; margin: 0.5em 0; }
    button { padding: 0.5em 1em; margin: 1em 0; }
    .device { padding: 0.5em; margin: 0.5em 0; border-left: 4px solid #ccc; background: #f9f9f9; }
  </style>
</head>
<body>
  <h2>üì° Novacene Viewer ‚Äì Sensor Status (CO‚ÇÇ, Temp, Humidity)</h2>

  <label for="apiToken">API Token:</label>
  <input id="apiToken" type="text" placeholder="Paste your token..." />

  <label for="siteId">Site ID:</label>
  <input id="siteId" type="number" placeholder="e.g. 471" value="471" />

  <label for="zoneId">Zone ID (Beer Fridge = 12651):</label>
  <input id="zoneId" type="number" placeholder="e.g. 12651" value="12651" />

  <button onclick="fetchDevices()">Fetch Devices & Sensors</button>

  <div id="output"></div>

  <label for="sensorDropdown">üìä Available Sensors:</label>
  <select id="sensorDropdown">
    <option disabled selected>Choose a sensor to explore...</option>
  </select>

  <script>
    async function fetchDevices() {
      const apiToken = document.getElementById('apiToken').value;
      const siteId = document.getElementById('siteId').value;
      const zoneId = document.getElementById('zoneId').value;
      const output = document.getElementById('output');
      const sensorDropdown = document.getElementById('sensorDropdown');
      output.innerHTML = '‚è≥ Fetching devices...';
      sensorDropdown.innerHTML = '<option disabled selected>Choose a sensor to explore...</option>';

      const url = `https://api-prod.novacene.io/api/v2/devices?page=1&limit=10000&siteid=${siteId}&zoneids=${zoneId}`;

      const res = await fetch(url, {
        headers: {
          'api_token': apiToken
        }
      });

      if (!res.ok) {
        output.innerHTML = '‚ùå Error fetching devices.';
        return;
      }

      const data = await res.json();
      if (!data.devices || !data.devices.length) {
        output.innerHTML = '‚ö†Ô∏è No devices found in this zone.';
        return;
      }

      let out = '';
      data.devices.forEach(device => {
        out += `<div class="device">
          <strong>üìü ${device.name} (ID: ${device.id})</strong><br/>`;
        if (device.sensors && device.sensors.length) {
          device.sensors.forEach(sensor => {
            out += `üîπ ${sensor.name}: ${sensor.lastReceivedDataValue} ${sensor.unit || ''} @ ${sensor.lastReceivedData}<br/>`;
            sensorDropdown.innerHTML += `<option value="${sensor.sensorToken}">${device.name} ‚Äì ${sensor.name}</option>`;
          });
        } else {
          out += '‚ö†Ô∏è No sensors found for this device.';
        }
        out += '</div>';
      });
      output.innerHTML = out;
    }
  </script>
</body>
</html>
