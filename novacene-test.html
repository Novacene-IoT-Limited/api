<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Novacene Debug Viewer</title>
  <style>
    body { font-family: sans-serif; padding: 2rem; }
    select, input, button { margin: 0.5rem 0; display: block; width: 100%; max-width: 400px; }
    label { font-weight: bold; margin-top: 1rem; }
  </style>
</head>
<body>
  <h1>üì° Novacene Debug Viewer ‚Äì Site & Zone Loader</h1>

  <label for="apiToken">API Token:</label>
  <input type="text" id="apiToken" placeholder="Paste your Novacene API token">

  <label><input type="checkbox" id="rememberKey"> Remember Key</label>

  <button id="connectBtn">Connect and Load Sites & Zones</button>

  <label for="siteSelect">Site:</label>
  <select id="siteSelect"></select>

  <label for="zoneSelect">Zone:</label>
  <select id="zoneSelect"></select>

  <pre id="debugOutput" style="background:#f0f0f0;padding:1rem;margin-top:2rem;"></pre>

  <script>
    const API_BASE = 'https://platform-api.novacene.io';

    const apiTokenInput = document.getElementById('apiToken');
    const siteSelect = document.getElementById('siteSelect');
    const zoneSelect = document.getElementById('zoneSelect');
    const debugOutput = document.getElementById('debugOutput');

    if (localStorage.getItem('novacene_api_token')) {
      apiTokenInput.value = localStorage.getItem('novacene_api_token');
      document.getElementById('rememberKey').checked = true;
    }

    document.getElementById('connectBtn').addEventListener('click', async () => {
      const apiToken = apiTokenInput.value.trim();
      if (!apiToken) return alert('Missing API token');

      if (document.getElementById('rememberKey').checked) {
        localStorage.setItem('novacene_api_token', apiToken);
      } else {
        localStorage.removeItem('novacene_api_token');
      }

      try {
        debugOutput.textContent = 'Loading sites...';
        const siteRes = await fetch(`${API_BASE}/sites`, {
          headers: { 'api_token': apiToken }
        });

        const sites = await siteRes.json();
        debugOutput.textContent += `\nSites: ${JSON.stringify(sites, null, 2)}`;

        siteSelect.innerHTML = sites.map(site => 
          `<option value="${site.id}">${site.name}</option>`
        ).join('');

        const selectedSiteId = siteSelect.value;
        debugOutput.textContent += `\nSelected Site ID: ${selectedSiteId}`;

        debugOutput.textContent += '\nLoading zones...';
        const zoneRes = await fetch(`${API_BASE}/zones?siteid=${selectedSiteId}`, {
          headers: { 'api_token': apiToken }
        });

        const zones = await zoneRes.json();
        debugOutput.textContent += `\nZones: ${JSON.stringify(zones, null, 2)}`;

        zoneSelect.innerHTML = zones.map(zone => 
          `<option value="${zone.id}">${zone.name}</option>`
        ).join('');
      } catch (err) {
        console.error(err);
        debugOutput.textContent += `\n\n‚ùå Error: ${err}`;
        alert('Error loading sites or zones. See debug output below.');
      }
    });
  </script>
</body>
</html>
